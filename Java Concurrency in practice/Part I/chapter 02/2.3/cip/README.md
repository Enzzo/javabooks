# 2.3 Блокировка

- Чтобы сохранить состояние согласованным, обновляйте связанные переменные состояний в одной атомарной операции.

- Реентрабельность (reentrancy) означает, что блокировки приобретаются для каждого потока, а не для каждого вызова. Реентрабельность реализуется путём связывания с каждой блокировкой счётчика полученных захватов и владеющего потока. Если число захватов равно нулю, блокировка считается отпущенной. Когда поток получает ранее отпущенную блокировку, JVM записывает владельца и устанавливает счётчику захватов значение единица. Если тот же самый поток снова получает блокировку, счётчик увеличивается, и когда владеющий блокировкой поток выходит из блока synchronized, счётчик уменьшается. Когда значение счётчика достигает нуля, блокировка снимается.

- К каждой изменяемой переменной состояния, к которой может обращаться более одного потока, все обращения должны выполняться с одной и той же блокировкой. В этом случае мы можем сказать, что переменная защищена этой блокировкой.

- Каждая разделяемая, изменяемая переменная должна быть защищена только одной блокировкой. Пишите код прозрачно для тех, кто будет его сопровождать: блокировка должна явно соотноситься с переменной.